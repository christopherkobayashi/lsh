## Process this file with make_am to produce Makefile.am
SUBDIRS: lib include
CVS_HEADERS: cvs_headers
CLASS_FILES: dist_x_files
BODY:

AUTOMAKE_OPTIONS = foreign
SUBDIRS = lib include

# To remake all Makefile.am-files, run
#
# 	./make_am
#
# You should run ./make_am --rethink after recompiling, but before
# making a dist, as it uses dependency information to figure out which
# header files should be included in th dist. How to tell this to
# make? FIXME: These rules won't remake Makefile.am files in
# subdrectries.

Makefile.am: Makefile.am.in
	./make_am

bin_PROGRAMS = lsh lshd

# Don't use BUILT_SOURCES, as all these files are #included, and can't be
# compiled or dependency checked independently.

generated_sources = atoms_defines.h atoms_gperf.c atoms_table.c

common_sources = abstract_io.c abstract_crypto.c alist.c atoms.c \
	bignum.c channel.c charset.c connection.c crypto.c \
	debug.c disconnect.c encrypt.c format.c gc.c getopt.c io.c keyexchange.c \
	list.c packet_ignore.c pad.c parse.c password.c publickey_crypto.c \
	randomness.c \
	read_data.c read_line.c read_packet.c service.c \
	translate_signal.c unpad.c userauth.c \
	werror.c write_buffer.c xalloc.c 

lsh_SOURCES = $(common_sources) lsh.c client.c client_keyexchange.c \
	client_password.c client_userauth.c

lshd_SOURCES = $(common_sources) lshd.c reaper.c server.c server_keyexchange.c \
	server_password.c server_userauth.c

atoms_defines.h: atoms.in process_atoms
	bash $(srcdir)/process_atoms header <$(srcdir)/atoms.in >$@

atoms_gperf.c: atoms.in process_atoms
	bash $(srcdir)/process_atoms gperf <$(srcdir)/atoms.in \
             | gperf -t -c -l -k1,7,$$ -N gperf_atom >$@

atoms_table.c: atoms.in process_atoms
	bash $(srcdir)/process_atoms table <$(srcdir)/atoms.in >$@

LDADD = @LIBOBJS@ lib/libsymmetric.a

lsh_DEPENDENCIES = @LIBOBJS@ symmetric
lshd_DEPENDENCIES = @LIBOBJS@ symmetric

.PHONY: symmetric
symmetric:
	(cd lib && $(MAKE) libsymmetric.a)

EXTRA_DIST = atoms.in process_atoms make_class $(generated_sources) HACKING \
	$(cvs_headers) $(dist_x_files) Makefile.am.in make_am

# Class files
# SUFFIXES = .xh .xc

# This is GNU make specific

%.x: % $(srcdir)/make_class
	$(srcdir)/make_class <$< >$@

