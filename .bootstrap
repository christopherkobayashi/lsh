#! /bin/sh

# Build all automatically generated files that are not present in the
# CVS repository.

# This script is for use in the source directory, before you run
# configure. To get started from a fresh CVS checkout, you also need
# to run configure and make bootstrap from your build directory.

set -e

relative_symlink() {
    (
	target="$1"
	shift
	while [ $# -ge 1 ] ; do
	    dir="$1"
	    if [ "$dir" = "." ] ; then
		ln -s "$target" "$dir"
	    else
		dotdots="`echo "$dir" | sed 's%[^/][^/]*%..%g'`"
		(cd "$dir" && ln -s "$dotdots/$target" . || true)
	    fi
	    shift
	done
    )
}

relative_symlink misc/run-tests \
    src/testsuite src/argp/testsuite src/nettle/testsuite src/spki/testsuite

# relative_symlink misc/acinclude.m4 \
#     . src/nettle src/spki
# 
# relative_symlink misc/memxor.c \
#     src src/nettle
# 
# relative_symlink misc/memxor.h \
#     src src/nettle

for subdir in src/argp src/nettle src/sftp src/spki ; do
    (cd $subdir && ./.bootstrap)
done

aclocal && autoconf && autoheader && automake -a
