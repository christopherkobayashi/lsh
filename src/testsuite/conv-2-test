#! /bin/sh

# Tests the conversion programs

if [ -z "$srcdir" ] ; then
  srcdir=`pwd`
fi

. $srcdir/functions.sh

# Keep silent unless -v is used.

if [ x$1 != x-v ]; then
    exec 2>/dev/null
fi

# All output is diagnostic
exec 1>&2

echo "conv-test: Testing ssh-conv and sexp-conv"

if [ -z "$srcdir" ] ; then
  srcdir=`pwd`
fi

($srcdir/../ssh-conv --decode-with ../lsh-decode-key | ../sexp-conv |tee test.out1) <<EOF
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEApUmWhj0f4TD/XcDW88zcKo1ZYBn09jT0RzP1aoPwKuzFbvupfbvKjPB3SC6r8cXTH0OY60EdfcQs1YmteIJNMEnWEvV9ZHPJYanU6dVSlajnbKwEhqrFMLlRuS4UKJQ67A5NFt0WV9DjYaLIzY5RmPJYci/C8bo+Pawj8r/j1As= markus@cvs.openssh.com
EOF

cat >test.out2 <<EOF
(public-key (rsa-pkcs1-sha1 (n |pUmWhj0f4TD/XcDW88zcKo1ZYBn09jT0RzP1aoPw
                                KuzFbvupfbvKjPB3SC6r8cXTH0OY60EdfcQs1Ymt
                                eIJNMEnWEvV9ZHPJYanU6dVSlajnbKwEhqrFMLlR
                                uS4UKJQ67A5NFt0WV9DjYaLIzY5RmPJYci/C8bo+
                                Pawj8r/j1As=|)
                            (e "#")))
EOF

compare_output "conv-2-test"
